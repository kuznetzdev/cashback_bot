"""Localization helpers for the cashback bot."""
from __future__ import annotations

from dataclasses import dataclass
from typing import Dict


@dataclass
class Translator:
    default_locale: str = "en"

    _translations: Dict[str, Dict[str, str]] = None  # type: ignore[assignment]

    def __post_init__(self) -> None:
        self._translations = {
            "en": {
                "start_message": "Welcome to Cashback Assistant! Choose an option below.",
                "main_menu": "Main menu",
                "menu_manual": "Manual input",
                "menu_analytics": "Analytics",
                "menu_cabinet": "Personal cabinet",
                "menu_settings": "Settings",
                "menu_wizard": "Add bank",
                "menu_analytics_pro": "PRO analytics",
                "menu_recommendations": "Recommendations",
                "menu_history": "Activity journal",
                "menu_profile": "Profile",
                "recent_receipts": "Recent receipts:",
                "receipt_added": "Receipt saved successfully.",
                "receipt_deleted": "Last receipt deleted.",
                "no_receipt": "No receipts found.",
                "send_receipt_prompt": "Send a receipt photo or enter details manually.",
                "manual_input_prompt": "Please send details in the format: merchant; category; amount; cashback; currency; YYYY-MM-DD",
                "analytics_header": "Your top cashback categories:",
                "analytics_row": "{idx}. {category} — {cashback:.2f} cashback ({rate:.2%})",
                "reminder": "Don't forget to upload receipts this month!",
                "unknown": "I didn't understand that. Use the menu to navigate.",
                "photo_prompt": "Use the menu to start receipt upload.",
                "ocr_failed": "OCR failed. Try manual input.",
                "parse_failed": "Could not parse receipt. Please send details manually.",
                "manual_format_error": "Format invalid. Please try again.",
                "manual_amount_error": "Amount or cashback is invalid. Please try again.",
                "best_cashback": "Best cashback category: {category} with {rate:.2%} return.",
                "no_cashback": "No cashback data yet.",
                "screen_main": "Choose an action to analyse cashback offers.",
                "wizard_select_bank": "Choose a bank from the list or pick Other to specify your own.",
                "wizard_other": "Other",
                "wizard_enter_name": "Send the bank name in a message.",
                "wizard_choose_input": "Select how you want to import categories.",
                "wizard_input_photo": "Photo (OCR)",
                "wizard_input_text": "Text",
                "wizard_input_template": "Template",
                "wizard_preview": "Preview the categories before saving.",
                "wizard_confirm": "Bank saved successfully!",
                "wizard_expect_photo": "Send a clear photo of the tariff page.",
                "wizard_expect_text": "Send categories in the format: Category - 5%. One per line.",
                "wizard_expect_template": "Select a template to prefill categories.",
                "wizard_no_categories": "No categories detected yet.",
                "button_next": "→ Next",
                "button_back": "← Back",
                "button_skip": "Skip",
                "button_cancel": "Cancel ❌",
                "button_delete": "Delete",
                "button_confirm": "Save",
                "button_edit": "Edit",
                "analytics_pro_header": "Advanced analytics",
                "analytics_worst_header": "Lowest categories:",
                "analytics_bucket_header": "Rates by buckets:",
                "analytics_strength_header": "Bank strength score:",
                "recommendations_header": "Recommendations",
                "recommendation_best_card": "Best card for {category}: {bank} ({rate}).",
                "recommendation_move": "Move cashback to {bank} for {category} ({rate}).",
                "recommendation_update": "Update {category} — current rate {rate}.",
                "recommendation_opportunity": "Consider boosting {category} (now {rate}).",
                "history_header": "Recent actions",
                "history_empty": "No actions recorded yet.",
                "history_cleared": "History cleared.",
                "profile_header": "Profile",
                "profile_points": "Points: {points}",
                "profile_level": "Level: {level}",
                "notifications_header": "Notification settings",
                "notifications_monthly": "Monthly summary (1st day)",
                "notifications_warning": "30 days without updates",
                "notifications_critical": "90 days without activity",
                "notifications_on": "On",
                "notifications_off": "Off",
                "reminder_monthly": "Time to refresh your cashback offers for this month!",
                "reminder_warning": "You have not updated your banks for 30 days.",
                "reminder_critical": "Three months without activity — refresh your data?",
                "status_processing": "⏳ Processing…",
                "status_ocr": "⏳ Running OCR…",
                "status_saved": "✅ Saved.",
                "templates_header": "Templates",
                "templates_empty": "No templates yet.",
                "templates_add": "Create template",
                "templates_prompt_new": "Send template as: Name | Category1, Category2",
                "templates_saved": "Template saved.",
                "templates_deleted": "Template removed.",
                "templates_invalid": "Could not parse template. Use: Name | Category1, Category2",
            },
            "ru": {
                "start_message": "Добро пожаловать в Cashback Assistant! Выберите действие ниже.",
                "main_menu": "Главное меню",
                "menu_manual": "Ввести вручную",
                "menu_analytics": "Аналитика",
                "menu_cabinet": "Личный кабинет",
                "menu_settings": "Настройки",
                "menu_wizard": "Добавить банк",
                "menu_analytics_pro": "PRO-аналитика",
                "menu_recommendations": "Рекомендации",
                "menu_history": "Журнал действий",
                "menu_profile": "Профиль",
                "recent_receipts": "Последние чеки:",
                "receipt_added": "Чек успешно сохранён.",
                "receipt_deleted": "Последний чек удалён.",
                "no_receipt": "Чеки не найдены.",
                "send_receipt_prompt": "Отправьте фото чека или введите данные вручную.",
                "manual_input_prompt": "Отправьте данные в формате: магазин; категория; сумма; кешбэк; валюта; ГГГГ-ММ-ДД",
                "analytics_header": "Ваши лучшие категории кешбэка:",
                "analytics_row": "{idx}. {category} — {cashback:.2f} кешбэк ({rate:.2%})",
                "reminder": "Не забудьте загрузить чеки в этом месяце!",
                "unknown": "Я не понял сообщение. Воспользуйтесь меню.",
                "photo_prompt": "Используйте меню, чтобы начать загрузку чека.",
                "ocr_failed": "Распознавание не удалось. Попробуйте ввести данные вручную.",
                "parse_failed": "Не удалось разобрать чек. Введите данные вручную.",
                "manual_format_error": "Неверный формат. Попробуйте снова.",
                "manual_amount_error": "Некорректная сумма или кешбэк. Попробуйте снова.",
                "best_cashback": "Лучшая категория кешбэка: {category} с доходностью {rate:.2%}.",
                "no_cashback": "Данных по кешбэку пока нет.",
                "screen_main": "Выберите раздел для анализа предложений по кешбэку.",
                "wizard_select_bank": "Выберите банк из списка или нажмите 'Другой'.",
                "wizard_other": "Другой",
                "wizard_enter_name": "Отправьте название банка сообщением.",
                "wizard_choose_input": "Выберите способ загрузки категорий.",
                "wizard_input_photo": "Фото (OCR)",
                "wizard_input_text": "Текст",
                "wizard_input_template": "Шаблон",
                "wizard_preview": "Проверьте категории перед сохранением.",
                "wizard_confirm": "Банк успешно сохранён!",
                "wizard_expect_photo": "Отправьте чёткое фото тарифов.",
                "wizard_expect_text": "Отправьте категории в формате: Категория - 5%. По одной строке.",
                "wizard_expect_template": "Выберите шаблон для предварительного заполнения.",
                "wizard_no_categories": "Категории ещё не получены.",
                "button_next": "→ Далее",
                "button_back": "← Назад",
                "button_skip": "Пропустить",
                "button_cancel": "Отмена ❌",
                "button_delete": "Удалить",
                "button_confirm": "Сохранить",
                "button_edit": "Редактировать",
                "analytics_pro_header": "Расширенная аналитика",
                "analytics_worst_header": "Самые слабые категории:",
                "analytics_bucket_header": "Ставки по диапазонам:",
                "analytics_strength_header": "Сила банков:",
                "recommendations_header": "Рекомендации",
                "recommendation_best_card": "Лучший банк для {category}: {bank} ({rate}).",
                "recommendation_move": "Перенесите покупки в {bank} для {category} ({rate}).",
                "recommendation_update": "Обновите {category} — текущая ставка {rate}.",
                "recommendation_opportunity": "Подумайте об усилении {category} (сейчас {rate}).",
                "history_header": "Журнал действий",
                "history_empty": "Записей пока нет.",
                "history_cleared": "Журнал очищен.",
                "profile_header": "Профиль",
                "profile_points": "Баллы: {points}",
                "profile_level": "Уровень: {level}",
                "notifications_header": "Настройки уведомлений",
                "notifications_monthly": "Ежемесячно (1 число)",
                "notifications_warning": "30 дней без обновлений",
                "notifications_critical": "3 месяца без активности",
                "notifications_on": "Вкл",
                "notifications_off": "Выкл",
                "reminder_monthly": "Пора обновить данные по кешбэку!",
                "reminder_warning": "30 дней без обновлений банков.",
                "reminder_critical": "3 месяца без активности — обновим данные?",
                "status_processing": "⏳ Обрабатываю…",
                "status_ocr": "⏳ Запускаю OCR…",
                "status_saved": "✅ Сохранено.",
                "templates_header": "Шаблоны",
                "templates_empty": "Шаблонов пока нет.",
                "templates_add": "Создать шаблон",
                "templates_prompt_new": "Отправьте шаблон в формате: Название | Категория1, Категория2",
                "templates_saved": "Шаблон сохранён.",
                "templates_deleted": "Шаблон удалён.",
                "templates_invalid": "Не удалось разобрать шаблон. Используйте формат: Название | Категория1, Категория2",
            },
        }

    def translate(self, key: str, locale: str | None = None) -> str:
        catalog = self._translations.get(locale or self.default_locale) or self._translations[self.default_locale]
        return catalog.get(key, key)
