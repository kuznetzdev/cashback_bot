# Пользовательские сценарии cashback_bot

Этот документ описывает ключевые сценарии, реализованные в текущей версии бота.

## Навигация по разделам

* Главный экран предоставляет навигационные кнопки в разделы: добавление банка, шаблоны чеков, PRO-аналитика, рекомендации, история, геймификация и уведомления.
* Каждое нажатие на кнопку создаёт структурированное `callback_data` с префиксом `nav:`. UI-слой отвечает за единое оформление сообщений и клавиатур.

## Мастер добавления банка

1. Пользователь открывает раздел «Добавить банк» (`nav:add_bank`).
2. Бот запускает мастер из трёх шагов: название банка, счёт/карта, предпочтения по кешбэку.
3. После ввода всех данных создаётся запись в хранилище и начисляется опыт геймификации.

## Шаблоны чеков

* Раздел «Шаблоны чеков» отображает все созданные вручную или рекомендованные шаблоны.
* Доступны действия редактирования (`edit:*`) и удаления (`del:*`) с автоматическим скрытием клавиатуры после выбора.
* Кнопка «Добавить шаблон» запускает ввод произвольного шаблона (`action:templates:add`).

## PRO-аналитика

* Раздел показывает состояние обработки и итоговый отчёт по транзакциям.
* Перед расчётами бот показывает индикатор «⏳ Обрабатываю…» и имитирует `typing` в чате.
* Используются сервисы аналитики и ранжирования для вывода рейтинга категорий.

## Рекомендации и геймификация

* Recommendation Engine генерирует персональные советы исходя из суммы кешбэка.
* Gamification Engine отображает текущий уровень и прогресс опыта пользователя.

## Уведомления

* Поддерживаются режимы «умные», «еженедельный дайджест» и «выключено» (`action:notifications:*`).
* SchedulerService актуализирует фоновые задачи при смене режима.

## Обработка чеков

* Действие `action:process:receipt` запускает умный OCR, NLP и обогащение категорий.
* Для операций используются общие статусы и индикаторы, результаты сохраняются в БД.

## История операций

* Раздел «История» показывает список транзакций или сообщает о пустой истории.

Эти сценарии покрыты модульными тестами в `tests/test_bot_workflow.py`.
